# ‚úÖ Backend P2P –∏ PQC - –°—Ç–∞—Ç—É—Å —Å–±–æ—Ä–∫–∏

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **PQC (Post-Quantum Cryptography)**
- ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ **–ê–ª–≥–æ—Ä–∏—Ç–º**: Kyber1024-Dilithium5
- ‚úÖ **API Endpoint**: `/api/crypto/status`
- ‚úÖ **–°—Ç–∞—Ç—É—Å**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª—é—á–∞—Ö, –∞–ª–≥–æ—Ä–∏—Ç–º–µ, —Ä–µ–∂–∏–º–µ —Ä–∞–±–æ—Ç—ã
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Graceful fallback –µ—Å–ª–∏ liboqs-node –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω

### 2. **DHT (Distributed Hash Table)**
- ‚úÖ **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**: Kademlia DHT —Å 160 buckets
- ‚úÖ **Bootstrap**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ bootstrap nodes
- ‚úÖ **Node Management**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –ø–æ–∏—Å–∫ —É–∑–ª–æ–≤
- ‚úÖ **API Endpoint**: `/api/dht/nodes`
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Signaling Server –¥–ª—è peer discovery

### 3. **WebRTC Signaling Server**
- ‚úÖ **WebSocket Server**: –ù–∞ –ø–æ—Ä—Ç—É 3001 (–∏–ª–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- ‚úÖ **Path**: `/p2p-signaling`
- ‚úÖ **–§—É–Ω–∫—Ü–∏–∏**:
  - –û–±–º–µ–Ω SDP offers/answers
  - ICE candidate exchange
  - Peer discovery —á–µ—Ä–µ–∑ DHT
  - Ping/pong –¥–ª—è health checks
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∏—Ä–æ–≤ –≤ DHT
- ‚úÖ **Graceful Shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### 4. **API Endpoints**

#### `/api/peers`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö P2P —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ P2P —É–∑–ª–∞, Signaling Server –∏ DHT
- **Response**:
  ```json
  {
    "connected": 5,
    "total": 10,
    "list": [...],
    "signaling": {
      "connections": 3,
      "peers": 5,
      "connectedPeers": 3,
      "dhtNodes": 10,
      "dhtBuckets": 5
    },
    "dht": {
      "totalNodes": 10,
      "bucketsUsed": 5,
      "bootstrapNodes": 3
    }
  }
  ```

#### `/api/crypto/status`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å PQC –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏
- **Response**:
  ```json
  {
    "initialized": true,
    "algorithm": "Kyber1024-Dilithium5",
    "keyPairs": 1,
    "kyberKeySize": 1568,
    "dilithiumKeySize": 2544,
    "production": false
  }
  ```

#### `/api/dht/nodes`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —É–∑–ª—ã –∏–∑ DHT
- **Response**:
  ```json
  {
    "nodes": [...],
    "stats": {
      "totalNodes": 10,
      "bucketsUsed": 5,
      "bootstrapNodes": 3
    }
  }
  ```

#### `/api/health`
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π health check —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **Response**:
  ```json
  {
    "status": "ok",
    "timestamp": 1234567890,
    "uptime": 3600000,
    "version": "1.0.0",
    "components": {
      "crypto": { ... },
      "signaling": { ... },
      "dht": { ... },
      "p2p": { ... },
      "storage": { ... },
      "ai": { ... }
    }
  }
  ```

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
1. ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PQC Crypto (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π)
3. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Storage –∏ Cache
4. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CRDT –∏ Sync Engine
5. ‚úÖ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DHT** (bootstrap)
6. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è P2P Node
7. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI Engine
8. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è System Monitor
9. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ API endpoints**
10. ‚úÖ **–ó–∞–ø—É—Å–∫ WebRTC Signaling Server** (—Å shared DHT)

### –°–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:
- ‚úÖ **DHT ‚Üí Signaling Server**: Shared instance –¥–ª—è peer discovery
- ‚úÖ **PQC ‚Üí P2P**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ **Signaling Server ‚Üí DHT**: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–∏—Ä–æ–≤
- ‚úÖ **All ‚Üí API**: –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ REST API

## üõ°Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### PQC Crypto
- ‚úÖ Graceful fallback –µ—Å–ª–∏ liboqs-node –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### DHT
- ‚úÖ Try-catch –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ bootstrap nodes
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ –ø–∞–¥–µ–Ω–∏–π

### Signaling Server
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ä—Ç–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ Graceful shutdown –≤—Å–µ—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

### API Endpoints
- ‚úÖ Try-catch –≤–æ–∫—Ä—É–≥ –≤—Å–µ—Ö endpoints
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã (200/503)
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ logger
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ –ú–µ—Ç–æ–¥ `getStats()` –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ `/api/peers`
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ `/api/health`

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ Shared DHT instance (–Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç)
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Maps –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞)
- ‚úÖ –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (ping, DHT bootstrap) –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã:
- Ping interval: 30 —Å–µ–∫—É–Ω–¥
- DHT bootstrap: 60 —Å–µ–∫—É–Ω–¥
- Health check: On-demand

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ PQC –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∫–≤–∞–Ω—Ç–æ–≤—ã—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è peer IDs
- ‚úÖ Graceful handling –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## ‚ú® Graceful Shutdown

- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ SIGINT/SIGTERM
- ‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ –≤—Å–µ—Ö WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ shutdown

## üìù –ò—Ç–æ–≥

**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç "–∫–∞–∫ —à–≤–µ–π—Ü–∞—Ä—Å–∫–∏–µ —á–∞—Å—ã":**

‚úÖ PQC –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ DHT –ø—Ä–∞–≤–∏–ª—å–Ω–æ bootstrap–∏—Ç—Å—è –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —É–∑–ª–∞–º–∏  
‚úÖ Signaling Server –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Ä–∞–º–∏  
‚úÖ –í—Å–µ API endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑—É–ø—Ä–µ—á–Ω–æ  
‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ —É–ø–∞—Å—Ç—å  
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã  
‚úÖ Graceful shutdown –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —á–∏—Å—Ç–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã  

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
